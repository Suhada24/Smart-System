document.addEventListener("DOMContentLoaded",()=>{initEventListeners(),initToolbar(),initSidebar(),initProfile(),initDashboard(),initCalendar(),initMessages()});const themeToggle=document.getElementById("themeToggle"),menuToggle=document.getElementById("menuToggle"),userProfile=document.getElementById("userProfile"),userMenu=document.getElementById("userMenu"),notificationToggle=document.getElementById("notificationToggle"),notificationPanel=document.getElementById("notificationPanel"),sidebarItems=document.querySelectorAll(".sidebar-item"),mobileSidebarBtn=document.getElementById("mobileSidebarBtn"),mobileMenuToggle=document.getElementById("mobileMenuToggle"),mobileSidebar=document.getElementById("sidebar"),navLinks=document.querySelector(".nav-links");function initEventListeners(){mobileMenuToggle&&(mobileMenuToggle.addEventListener("click",function(){navLinks.classList.toggle("active")}),document.addEventListener("click",function(e){!navLinks.contains(e.target)&&e.target!==mobileMenuToggle&&!mobileMenuToggle.contains(e.target)&&navLinks.classList.remove("active")})),sidebarItems.forEach(e=>{e.addEventListener("click",function(){const t=this.getAttribute("data-role");sidebarItems.forEach(e=>e.classList.remove("active")),this.classList.add("active"),loadDashboard(t)})}),document.querySelectorAll(".mobile-nav-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.getAttribute("data-role");document.querySelectorAll(".mobile-nav-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active"),loadDashboard(t)})}),initSidebarCollapse()}function initSidebarCollapse(){const e=document.getElementById("sidebarCollapseBtn"),t=document.getElementById("sidebar");if(e&&t){e.addEventListener("click",function(){t.classList.toggle("collapsed");const e=t.classList.contains("collapsed");localStorage.setItem("sidebarCollapsed",e)});"true"===localStorage.getItem("sidebarCollapsed")&&t.classList.add("collapsed")}}function initToolbar(){themeToggle&&themeToggle.addEventListener("click",toggleTheme),notificationToggle&&(notificationToggle.addEventListener("click",function(e){e.stopPropagation(),notificationPanel.classList.toggle("active")}),document.addEventListener("click",function(e){notificationPanel.classList.contains("active")&&!notificationPanel.contains(e.target)&&e.target!==notificationToggle&&notificationPanel.classList.remove("active")})),userProfile&&userProfile.addEventListener("click",function(e){e.stopPropagation(),userMenu.classList.toggle("active")}),document.addEventListener("click",function(e){userMenu.classList.contains("active")&&!userMenu.contains(e.target)&&e.target!==userProfile&&userMenu.classList.remove("active")})}function toggleTheme(){document.body.classList.toggle("dark-theme");const e=document.body.classList.contains("dark-theme")?"dark":"light";localStorage.setItem("theme",e)}function initProfile(){const e=localStorage.getItem("theme");"dark"===e&&document.body.classList.add("dark-theme")}function initSidebar(){const e=document.getElementById("sidebar");if(!e)return;const t=document.getElementById("mobileSidebarBtn"),n=document.getElementById("closeSidebar");t&&t.addEventListener("click",()=>{e.classList.add("active")}),n&&n.addEventListener("click",()=>{e.classList.remove("active")});const a=document.querySelectorAll(".sidebar-item.has-submenu");a.forEach(e=>{const t=e.querySelector("a"),n=e.querySelector(".submenu");t&&t.addEventListener("click",t=>{t.preventDefault(),a.forEach(t=>{t!==e&&t.classList.remove("open")}),e.classList.toggle("open"),document.querySelectorAll(".submenu").forEach(t=>{t!==n&&(t.style.maxHeight=null)}),e.classList.contains("open")?n.style.maxHeight=n.scrollHeight+"px":n.style.maxHeight=null})});const s=document.querySelectorAll(".submenu-item");s.forEach(e=>{e.addEventListener("click",()=>{a.forEach(e=>{e.classList.remove("active")}),s.forEach(e=>{e.classList.remove("active")}),e.classList.add("active")})})}function loadDashboard(e){e&&(("home"===e||""===e)&&fetchDashboard(),"courses"===e&&fetchCourses(),"messages"===e&&fetchMessages(),"calendar"===e&&fetchCalendar(),"admin"===e&&fetchAdminDashboard(),"profile"===e&&fetchProfile()),updateMobileNav(e)}function updateMobileNav(e){document.querySelectorAll(".mobile-nav-btn").forEach(t=>{t.getAttribute("data-role")===e?t.classList.add("active"):t.classList.remove("active")})}function fetchProfile(){const e=document.getElementById("main");e&&(e.innerHTML='<div class="loading-indicator"><div class="loading-spinner"></div></div>',setTimeout(()=>{fetch("components/profile.html").then(e=>e.text()).then(t=>{e.innerHTML=t}).catch(t=>{e.innerHTML='<div class="error-message">Error loading profile: '+t.message+"</div>"})},200))}function fetchDashboard(){const e=document.getElementById("main");e&&(e.innerHTML='<div class="loading-indicator"><div class="loading-spinner"></div></div>',setTimeout(()=>{fetch("components/dashboard.html").then(e=>e.text()).then(t=>{e.innerHTML=t,initDashboardCharts()}).catch(t=>{e.innerHTML='<div class="error-message">Error loading dashboard: '+t.message+"</div>"})},200))}function initDashboardCharts(){}function fetchCourses(){const e=document.getElementById("main");e&&(e.innerHTML='<div class="loading-indicator"><div class="loading-spinner"></div></div>',setTimeout(()=>{fetch("components/courses.html").then(e=>e.text()).then(t=>{e.innerHTML=t,initCourseFilters()}).catch(t=>{e.innerHTML='<div class="error-message">Error loading courses: '+t.message+"</div>"})},200))}function initCourseFilters(){const e=document.querySelectorAll(".course-filter-btn");e.length>0&&e.forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".course-filter-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active");const t=this.getAttribute("data-filter");document.querySelectorAll(".course-card").forEach(e=>{t?"all"===t?e.style.display="block":e.classList.contains(t)?e.style.display="block":e.style.display="none":e.style.display="block"})})})}function fetchMessages(){const e=document.getElementById("main");e&&(e.innerHTML='<div class="loading-indicator"><div class="loading-spinner"></div></div>',setTimeout(()=>{fetch("components/messages.html").then(e=>e.text()).then(t=>{e.innerHTML=t,initMessages()}).catch(t=>{e.innerHTML='<div class="error-message">Error loading messages: '+t.message+"</div>"})},200))}function fetchCalendar(){const e=document.getElementById("main");e&&(e.innerHTML='<div class="loading-indicator"><div class="loading-spinner"></div></div>',setTimeout(()=>{fetch("components/calendar.html").then(e=>e.text()).then(t=>{e.innerHTML=t}).catch(t=>{e.innerHTML='<div class="error-message">Error loading calendar: '+t.message+"</div>"})},200))}function fetchAdminDashboard(){const e=document.getElementById("main");e&&(e.innerHTML='<div class="loading-indicator"><div class="loading-spinner"></div></div>',setTimeout(()=>{fetch("components/admin-dashboard.html").then(e=>e.text()).then(t=>{e.innerHTML=t,initAdminDashboard()}).catch(t=>{e.innerHTML='<div class="error-message">Error loading admin dashboard: '+t.message+"</div>"})},200))}function initDashboard(){const e=document.querySelector(".sidebar-item[data-role=home]");e&&e.classList.add("active"),fetchDashboard()}function initCalendar(){const e=document.getElementById("calendarContainer");if(e)try{if(void 0===SchoolCalendar)return console.error("SchoolCalendar is not defined. Make sure calendar.js is loaded properly."),void(e.innerHTML='<div class="error-message">Calendar could not be loaded.</div>');const t=new SchoolCalendar;e.appendChild(t.calendarEl);const n=document.getElementById("prevMonthBtn"),a=document.getElementById("nextMonthBtn");n&&n.addEventListener("click",()=>{t.prevMonth()}),a&&a.addEventListener("click",()=>{t.nextMonth()})}catch(t){console.error("Calendar initialization error:",t),e.innerHTML='<div class="error-message">Error initializing calendar: '+t.message+"</div>"}}function initMessages(){document.querySelector(".messages-container")&&(document.querySelector(".message-form").addEventListener("submit",function(e){e.preventDefault(),sendMessage()}),document.querySelectorAll(".contact-item").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".contact-item").forEach(e=>e.classList.remove("active")),this.classList.add("active");const e=this.getAttribute("data-contact");document.querySelector(".messages-header h3").textContent=e})}))}function sendMessage(){const e=document.querySelector(".message-input"),t=document.querySelector(".messages-body");if(e&&t&&""!==e.value.trim())try{const n=e.value.trim(),a=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s=`\n            <div class="message sent">\n                <div class="message-content">\n                    <p>${n}</p>\n                    <span class="message-time">${a}</span>\n                </div>\n            </div>`;t.insertAdjacentHTML("beforeend",s),t.scrollTop=t.scrollHeight,e.value="",setTimeout(()=>{const e=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n=`\n                <div class="message received">\n                    <div class="message-content">\n                        <p>Thank you for your message. This is an automated response.</p>\n                        <span class="message-time">${e}</span>\n                    </div>\n                </div>`;t.insertAdjacentHTML("beforeend",n),t.scrollTop=t.scrollHeight},1e3)}catch(n){console.error("Error sending message:",n)}}function initAdminDashboard(){initDataTables(),initExport(),initAdminTools(),initUserManagement()}function initDataTables(){const e=document.querySelectorAll(".data-table");if(e.length)try{e.forEach(e=>{const t=e.querySelectorAll("th");t.forEach(e=>{const t=e.querySelector(".sort-icon");t&&e.addEventListener("click",function(){const n=t.textContent;t.textContent="▼"===n?"▲":"▼";})})})}catch(t){console.error("Error initializing data tables:",t)}}function initExport(){const e=document.querySelectorAll(".export-btn");e.length&&e.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-export-type"),t=this.getAttribute("data-table-id"),n=document.getElementById(t);if(n)switch(e){case"csv":exportTableToCSV(n);break;case"pdf":exportTableToPDF(n);break;case"excel":exportTableToExcel(n)}})})}function exportTableToCSV(e){}function exportTableToPDF(e){}function exportTableToExcel(e){}function initAdminTools(){const e=document.querySelector('.sidebar-item[data-role="admin-tools"]');if(e){const t=window.location.pathname;if(t.includes("/admin/")){const t=e.querySelector(".submenu");t&&(t.style.display="block")}document.querySelectorAll('.submenu-item[data-page]').forEach(e=>{const t=e.getAttribute("data-page"),n=window.location.pathname;n.includes(t+".html")&&e.classList.add("active")})}} 